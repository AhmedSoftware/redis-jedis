## Breaking Changes from Jedis 3 to Jedis 4 and Hints to Migrate

- Jedis and JedisPool constructors with a String parameter, and no int parameter only support a URL or URI string.
  - Jedis(String)
  - JedisPool(String)
  - JedisPool(String, SSLSocketFactory, SSLParameters, HostnameVerifier)
  - JedisPool(GenericObjectPoolConfig<Jedis>, String)

- In [XRANGE](https://redis.io/commands/XRANGE) and [XREVRANGE](https://redis.io/commands/xrevrange) methods with StreamEntryID as parameters,
  sending untyped `null` for both start and end parameters will raise conflicts.

  Casting the `null`s to StreamEntryID (`(StreamEntryID) null`) resolves this issue.

- Many SortedSet methods return Java `List` instead of `Set`. [Listed here](3to4-zset-list.md)

- Many methods return primitive values (`long`/`boolean`/`double` instead of `Long`/`Boolean`/`Double`). [Listed here](3to4-primitives.md)

- BinaryJedis and BinaryJedisCluster classes have been removed.

  Methods of these classes are available in Jedis and JedisCluster classes respectively.

- Client and BinaryClient classes have been removed.

- Commands interfaces were restructured, meaning `redis.clients.jedis.commands` package was reimplemented.

- The return type of Jedis.shutdown() is now `void`.<br>
  Previously, ideally, it would return null.

- ShardedJedisPool, Sharded, ShardedJedis, BinaryShardedJedis, ShardInfo, JedisShardInfo classes have been removed.
  - Introduced JedisSharding class to replace ShardedJedisPool.

      Earlier code without the use of "name" and "weight" (in ShardInfo/JedisShardInfo) are easily transferable to the new class.

- ShardedJedisPipeline class was removed.
  - Introduced ShardedPipeline class to replace ShardedJedisPipeline.

- The type of Protocol.CHARSET was changed to `java.nio.charset.Charset`.

- JedisCluster constructors with `GenericObjectPoolConfig<Jedis>` now accepts `GenericObjectPoolConfig<Connection>`.

- JedisCluster.getClusterNodes() returns `Map<String, ConnectionPool>` instead of `Map<String, JedisPool>`.

- JedisCluster.getConnectionFromSlot(int) returns `Connection` instead of `Jedis`.

- JedisClusterHostAndPortMap interface has been removed. Use the HostAndPortMapper interface.

- These classes were moved to the `redis.clients.jedis.args` package.
  - BitOP
  - GeoUnit
  - ListPosition

- These classes were moved to the `redis.clients.jedis.params` package.
  - BitPosParams
  - ScanParams
  - SortingParams
  - ZParams

- These classes were moved to the `redis.clients.jedis.resps` package.
  - AccessControlLogEntry
  - AccessControlUser
  - GeoRadiusResponse
  - ScanResult
  - Slowlog
  - StreamConsumersInfo
  - StreamEntry
  - StreamGroupInfo
  - StreamInfo
  - StreamPendingEntry
  - StreamPendingSummary
  - Tuple

- These BuilderFactory implementations were removed.
  - OBJECT (use RAW_OBJECT)
  - BYTE_ARRAY_ZSET (use BINARY_LIST or BINARY_SET)
  - BYTE_ARRAY_MAP (use BINARY_MAP)
  - STRING_ZSET (use STRING_LIST or STRING_SET)
  - EVAL_RESULT (use ENCODED_OBJECT)
  - EVAL_BINARY_RESULT (use RAW_OBJECT)

- ...
  - ClusterReset was removed. Use ClusterResetType.
  - DebugParams was removed.
  - JedisExhaustedPoolException was removed. A JedisException with a similar message is thrown instead.
  - JedisClusterMaxAttemptsException was removed. JedisClusterOperationException with with a similar message is thrown instead.
  - JedisNoReachableClusterNodeException was removed. JedisClusterOperationException with a similar message is thrown instead

- HostAndPort class
  - Removed variables
    - `localhost`

  - Removed methods
    - extractParts
    - parseString
    - convertHost
    - setLocalhost
    - getLocalhost
    - getLocalHostQuietly

- Protocol class
  - All String variables representing to Sentinel, Cluster and PubSub sub-commands have been removed.

- Sentinel methods were removed from Jedis class and can be found in the new Sentinel class.

- Transaction inside Pipeline were removed. E.g. multi(), exec() and discard() methods have been removed from Pipeline.

- execGetResponse() method was removed from Transaction.

- JedisClusterHashTagUtil class was renamed to JedisClusterHashTag.

- KeyMergeUtil class was removed.

- Jedis.aclLog(String) and Jedis.aclLog(byte[]) methods are removed.<br>
  Jedis.aclLogReset() method was added to serve the purpose.

- Jedis.debug(DebugParams) method was removed.

- Jedis.sync() method was removed.

- Jedis.configSetBinary(byte[], byte[]) method. Use Jedis.configSet(byte[], byte[]).

- Jedis.pubsubNumSub(String...) method returns `Map<String, Long>` instead of `Map<String, String>`.

- Jedis.scriptExists(byte[]) returns `Boolean` instead of `Long`.

- Jedis.scriptExists(byte[]...) returns `List<Boolean>` instead of `List<Long>`.

- `watch` and `unwatch` methods of Transaction class is unsupported within MULTI (after multi() method). It can be used before MULTI.

- Each of the following cases would throw an IllegalStateException instead of a JedisDataException.
  - `Cannot use Jedis when in Multi. Please use Transaction or reset jedis state.`
  - `Cannot use Jedis when in Pipeline. Please use Pipeline or reset jedis state.`

- `eval` and `evalsha` methods are now non-blocking. These were blocking in Jedis 3.x.

- Queable.getResponse(Builder<T> builder) method has been renamed to Queable.enqueResponse(Builder<T> builder).

- All methods in Queable are now `final`:
  - clean()
  - generateResponse(Object data)
  - enqueResponse(Builder<T> builder)
  - getPipelinedResponseLength()
