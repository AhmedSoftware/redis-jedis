sudo: required
language: java
jdk:
  - openjdk7
  - oraclejdk7
  - oraclejdk8
before_install:
    - wget -O stunnel.tar.gz ftp://ftp.stunnel.org/stunnel/archive/5.x/stunnel-5.29.tar.gz
    - tar -xvzf stunnel.tar.gz
    - cd ./stunnel-5.29 && ./configure && make && sudo make install && cd ..
install:
  - make travis-install
script:
  -
    VERSION=$(mvn org.apache.maven.plugins:maven-help-plugin:2.1.1:evaluate -Dexpression=project.version|grep -Ev '(^\[|Download\w+:)')
  - echo "Project Version ${VERSION}"
  - |
    if [[ ${TRAVIS_PULL_REQUEST} == "false" && ${TRAVIS_SECURE_ENV_VARS} && $VERSION =~ ^.*-SNAPSHOT$ ]] ; then
      TEST="\!ModuleTest" make deploy
    else
      TEST="\!ModuleTest" make test
    fi
cache:
  directories:
  - "$HOME/.m2"
addons:
  hostname: jedis
